---
title: "COD Reproducibility Report"
output:
  html_document:
    toc: true
    toc_float: true
---

#### Article ID: jjmld
#### Pilot: Gustav Nilsonne
#### Co-pilot: Tom Hardwicke  
#### Start date: 05/12/17
#### End date: 06/13/17

-------

#### Note: 
It was not possible to perform any descriptive or inferential analyses due to missing data. This documents contains some code written in anticipation of complete data.

-------

#### Methods summary: 
The research hypothesis was that threatening visual input would gain faster access to awareness than non-threatening visual input. Threatening stimuli were generated by conditioning where images of colored annuli were paired with electrical shocks. in the main experiment, treatening and non-threatening stimuli were presented during a continuous flash suppression task. Response time was the main outcome.

------

#### Target outcomes: 
> We conducted a 2 × 2 repeated-measures ANOVA with the within-subject factors Conditioning and Suppression, and the between-subject factor Color. This revealed a main effect of Conditioning, F(1, 14) = 8.97, p = .010, η2 = .39, showing that, irrespective of the Suppression condition, trials in which a CS+ annulus was presented (M = 1557 ms, SD = 284) yielded faster response times than trials in which a CS− annulus was presented (M = 1718, SD = 432). The absence of a main effect of Suppression, F(1, 14) = .20, p = .659, η2 = .01, indicated that we successfully matched the response times of trials in which the targets were interocularly suppressed (M = 1660 ms, SD = 524), and trials in which they were not (M = 1615 ms, SD = 248). This is an important requirement for making a fair comparison between effects in the suppression condition and the monocular control condition (Stein et al., 2011). The between-subject factor Color did not interact with either Suppression (p = 0.175) or Conditioning (p = 0.623). Finally, there was an interaction between Suppression and Conditioning on response times, F(1, 14) = 13.98, p = .002, η2 = .50, but no three-way interaction with the between-subject factor Color, F(1, 14) = .08, p = .780, η2 = .01. This shows that the interaction between Conditioning and Suppression did not depend on the specific color that was paired with electric shocks.

> Subsequent paired-samples t-tests revealed that when targets were interocularly suppressed, discrimination of the oriented gratings was faster when they were surrounded by a CS+ annulus (M = 1498 ms, SD = 416) than a CS− annulus (M = 1822 ms, SD = 646), t(15) = 3.72, p = .002, Cohen’s d = 1.92. When the grating and annulus were not interocularly suppressed (i.e., in the monocular condition), however, response times did not differ between CS+ trials (M = 1615 ms, SD = 252) and CS− trials (M = 1614 ms, SD = 271), t(15) = .04, p = .968, Cohen’s d = .02. There was no correlation between the influence of conditioning on response times in the monocular condition and the suppression condition, R(14) = .29, p = .276. To assert that the absence of an effect of conditioning in the monocular condition reflected a null effect rather than experimental insensitivity we computed a Bayes factor (Dienes, 2014). The alternative hypothesis was modelled as a uniform distribution with a lower bound of zero and an upper bound equaling the effect of conditioning in the suppression condition. This revealed that the data was over seven times more likely to reflect a null effect than the alternative hypothesis (B01 = 7.14). Together, these findings demonstrate that stimuli that were previously paired with aversive stimulation, and therefore signal threat, are released from interocular suppression (322 ms) faster than stimuli that were not paired with a shock. The effect of conditioning on response times as a function of Suppression condition is depicted in Fig. 2A (group results) and 2B (individual results).

------

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

## Step 1: Load packages

```{r}
library(tidyverse) # for data munging
library(knitr) # for kable table formating
library(haven) # import and export 'SPSS', 'Stata' and 'SAS' Files
library(readxl) # import excel files
library(CODreports) # custom report functions
library(nlme)
```

## Step 2: Load data

```{r}
data <- read_excel("~/GitHub/set_jjmld/data/Raw_data_long_format_Exp1.xlsx", skip = 1)
names(data) <- c("Participant", "CFS_monocular", "CS", "infinite_RT", "RT", "LR_eye", "Trial", "Block", "Correct", "IncludedEye", "CSplusColor") # This removes characters that R has trouble understanding from variable names
```

The data file contains the following 11 variables:

- Participant: unique ID

- CFS_monocular: indicates whether target was suppressed or not

- CS: indicates whether target was aversive or not (i.e. conditioned stimulus)

- Infinite_RT: indicates whether response time reached the ceiling of 4 s

- RT: response time in seconds

- LR_eye: indicates whether target was presented to the left or to the right eye

- Trial: trial number (0-64)

- Block: block number (0 or 1), with 0 for the first 32 trials and 1 for the next 32 trials

TODO: add last three

## Step 3: Tidy data

```{r}
# Change factor variables from numeric before analysis
data$Participant <- as.factor(data$Participant)
data$CS <- as.factor(data$CS)
```

## Step 4: Run analysis

### Pre-processing
> For the analysis of response times, only trials with correct responses (93.3%, SD = 6.1) were included. (page 79)

```{r}
sum(data$Correct)/length(data$Correct)
data <- data[data$Correct == 1, ]
```

This comes to 93.1% rather than 93.3%. Nonetheless, I proceed according to the method described.

> Median response times were computed for each participant’s Conditioning and Suppression conditions. Truncating two response time distributions at the same numerical value (i.e., at the response time deadline of 4000 ms) would cause the analysis to include more data (from the slower end of the distribution) in the condition that yielded the fastest response times, thereby compromising a fair statistical comparison between the two conditions. In four participants, 50% of the trials in either the CS+ or the CS- condition yielded an infinitely long response (i.e., no response). As a consequence, the median response time for these participants was infinitely long as well, in at least one condition, and was therefore deemed uninformative. For these participants, we computed the median response times by including only the trials in which the target was presented to the dominant eye (i.e., the Eye condition that yielded the shortest response times). (page 79)

```{r}
# Find participants with 50% (or more) infinite response times
data_inf <- aggregate(infinite_RT ~ Participant + CS, data = data, sum)
participants_with_many_misses <- unique(data_inf$Participant[data_inf$infinite_RT > 4])

# Reduce data for those participants
rows_to_remove <- which(data$Participant %in% participants_with_many_misses & data$IncludedEye == 0)
data <- data[-rows_to_remove, ]

# Calculate medians
data_medians <- aggregate(RT ~ Participant + CFS_monocular + CS + CSplusColor, data = data, median)
```

There were five participants rather than four for which the specified conditions were true and data were reduced.

### Descriptive statistics
Descriptive statistics were reported in this paper as follow/up analyses to inferential statistics, but I have separated them and put them in this section.

> irrespective of the Suppression condition, trials in which a CS+ annulus was presented (M = 1557 ms, SD = 284) yielded faster response times than trials in which a CS− annulus was presented (M = 1718, SD = 432).

```{r}
m1 <- mean(data_medians$RT[data_medians$CS == 1])
compareValues(reportedValue = 1.557, obtainedValue = m1)

sd1 <- sd(data_medians$RT[data_medians$CS == 1])
compareValues(reportedValue = 0.284, obtainedValue = sd1)

m2 <- mean(data_medians$RT[data_medians$CS == 2])
compareValues(reportedValue = 1.718, obtainedValue = m2)

sd2 <- sd(data_medians$RT[data_medians$CS == 2])
compareValues(reportedValue = 0.432, obtainedValue = sd2)
```

The means are close, but the standard deviations are way off.

> [...] the response times of trials in which the targets were interocularly suppressed (M = 1660 ms, SD = 524), and trials in which they were not (M = 1615 ms, SD = 248).

```{r}
m3 <- mean(data_medians$RT[data_medians$CFS_monocular == 1])
compareValues(reportedValue = 1.660, obtainedValue = m3)

sd3 <- sd(data_medians$RT[data_medians$CFS_monocular == 1])
compareValues(reportedValue = 0.524, obtainedValue = sd3)

m4 <- mean(data_medians$RT[data_medians$CFS_monocular == 2])
compareValues(reportedValue = 1.615, obtainedValue = m4)

sd4 <- sd(data_medians$RT[data_medians$CFS_monocular == 2])
compareValues(reportedValue = 0.248, obtainedValue = sd4)
```

Means and standard deviations are close.

> Together, these findings demonstrate that stimuli that were previously paired with aversive stimulation, and therefore signal threat, are released from interocular suppression (322 ms) faster than stimuli that were not paired with a shock.

This phrasing suggests that the comparison is between 

```{r}
m5 <- (mean(data_medians$RT[data_medians$CS == 1 & data_medians$CFS_monocular == 2]) - 
mean(data_medians$RT[data_medians$CS == 1 & data_medians$CFS_monocular == 1])) -
(mean(data_medians$RT[data_medians$CS == 2 & data_medians$CFS_monocular == 2]) - 
mean(data_medians$RT[data_medians$CS == 2 & data_medians$CFS_monocular == 1]))
# NB: Check levels in the above calculation
compareValues(reportedValue = 0.322, obtainedValue = m5)
```

### Inferential statistics
> We conducted a 2 × 2 repeated-measures ANOVA with the within-subject factors Conditioning and Suppression, and the between-subject factor Color. This revealed a main effect of Conditioning, F(1, 14) = 8.97, p = .010, η2 = .39

> The absence of a main effect of Suppression, F(1, 14) = .20, p = .659, η2 = .01, indicated [...].

> The between-subject factor Color did not interact with either Suppression (p = 0.175) or Conditioning (p = 0.623). Finally, there was an interaction between Suppression and Conditioning on response times, F(1, 14) = 13.98, p = .002, η2 = .50, but no three-way interaction with the between-subject factor Color, F(1, 14) = .08, p = .780, η2 = .01.

It is not clear what kind of ANOVA was run. 

```{r}
aov1 <- aov(RT ~ CSplusColor + Error(Participant/(CFS_monocular+CS)), data_medians)
summary(aov1)

lme1 <- lme(RT ~ CSplusColor*CFS_monocular*CS, random = ~1|Participant, data_medians)
anova(lme1)
```

> Subsequent paired-samples t-tests revealed that when targets were interocularly suppressed, discrimination of the oriented gratings was faster when they were surrounded by a CS+ annulus (M = 1498 ms, SD = 416) than a CS− annulus (M = 1822 ms, SD = 646), t(15) = 3.72, p = .002, Cohen’s d = 1.92. When the grating and annulus were not interocularly suppressed (i.e., in the monocular condition), however, response times did not differ between CS+ trials (M = 1615 ms, SD = 252) and CS− trials (M = 1614 ms, SD = 271), t(15) = .04, p = .968, Cohen’s d = .02. There was no correlation between the influence of conditioning on response times in the monocular condition and the suppression condition, R(14) = .29, p = .276. 

```{r}
# To do a paired t-test, some form of data reduction is required, such as an averaging of medians over conditions. This step is not described.

#ttest1 <- t.test(data_medians$RT[data_medians$CS == 1], data_medians$RT[data_medians$CS == 2], type = "paired")

```

> To assert that the absence of an effect of conditioning in the monocular condition reflected a null effect rather than experimental insensitivity we computed a Bayes factor (Dienes, 2014). The alternative hypothesis was modelled as a uniform distribution with a lower bound of zero and an upper bound equaling the effect of conditioning in the suppression condition. This revealed that the data was over seven times more likely to reflect a null effect than the alternative hypothesis (B01 = 7.14). 

```{r}
#TODO
```

## Step 5: Conclusion


```{r}
# codReport(Report_Type = 'pilot',
#           Article_ID = 'jjmld', 
#           Insufficient_Information_Errors = 0,
#           Decision_Errors = 0, 
#           Major_Numerical_Errors = 0, 
#           Minor_Numerical_Errors = 0)
```


```{r session_info, include=TRUE, echo=TRUE, results='markup'}
devtools::session_info()
```
